<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
 "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
 <title>TLSView Manual</title>
 <style type="text/css" media=screen>
 <!-- 
 BODY { background-color: white }
 -->
 </style> 
</head>

<body>

<h1>TLSView Manual</h1>
<h3>A Molecular Viewer for TLS Rigid Body Motion</h3>

<center>
<table width="75%">
 <tr><th><img src="UTLS_VS_UR.png"></th></tr>
 <tr><td>
  <b>Figure 1</b>: TLSView visualization of protein backbone atoms using thermal ellipsoids contoured at the 50% isoprobability level.  Atoms from several independent TLS groups are shown in different colors.  This visualization uses two ellipsoids per atom.  One opaque ellipsoid is derived from the reduced translation tensor <var>T<sup>r</sup></var>, the minimum translational component of the TLS predicted anisotropic ADP for the atom.  The larger transparent ellipsoid is derived from the full TLS predicted ADP for the atom, <var>U<sup>TLS</sup></var>, which includes the additional displacement from three TLS screw motions.
 </td></tr>
</table>
</center>

<h3>Introduction</h3>
<p>
The TLSView molecular viewer specializes in visualizing TLS rigid body displacements in macromolecular structures.  It uses OpenGL for interactive graphics rendering, and supports most of the macromolecular visualization styles found it other programs.  TLSView includes several new visualizations designed to represent TLS model parameters as physical displacements of the atomic model.  The 20 parameters of a TLS model can be interpreted as six independent rigid body displacements: three orthogonal translational displacements, and three screw displacements.  The screw displacement axes are orthogonal, but do not necessarily intersect at a common point.  This is the canonical interpretation of TLS displacement, and the trajectories of these six independent displacements are used by TLSView to draw static trajectory paths and animate atomic model visualizations.
</p>

<!---------------------------------------------------------->
<!---------------------------------------------------------->
<hr>
<h3>Running TLSView</h3>

<p>
The TLSView program is located in the mmLib <i>applications/</i> directory, and the program is actually called <i>tlsviewer.py</i>.  For TLSView to run correctly, mmLib must be properly installed.  See the README.txt and INSTALL.txt files for instructions on how to correctly set up mmLib and its dependencies.  Once mmLib is installed, TLSView can be run by the shell command:
<pre>
# python tlsviewer.py [PDB/mmCIF path]
</pre>
</p>

<!---------------------------------------------------------->
<!---------------------------------------------------------->
<hr>
<h3>Translation, Libration, Skew (TLS) Model Overview</h3>

<p>
Here are links to well-written introductions of Chasles' Theorem, tensors, and the multivariate Gaussian distribution.  They are subjects used in the formulation of the TLS model.
</p>

<ul>
 <li><a href="http://www.seas.upenn.edu/~meam520/notes02/EulerChasles4.pdf">The Theorems of Euler and Chasles (PDF Document)</a></li>

 <li><a href="http://www.public.iastate.edu/~jba/tensors.pdf">Tensors in a Nutshell (PDF Document)</a></li>

 <li><a href="http://www.inf.ed.ac.uk/teaching/courses/pmr/slides/cts4up.pdf">The Multivariate Gaussian Distribution (PDF Document)</a></li>
</ul>

<p>
In Euclidean space, a rigid body undergoing displacement is fully described by a 3x3 rotation matrix <var>R</var> and a 3x1 translation vector <var>t</var>.  The displacement can be simplified further and described by a simple screw displacement(see Chasles' Theorem): a rotation about a 3x1 vector up to given rotational magnitude while being translated along the vector by a magnitude proportional to the rotation(screw pitch).  Keep in mind the screw displacement takes a rigid body from one orientation to another, but the literal screw displacement trajectory is probably not the actual trajectory followed by rigid body to get to the second orientation.  Even with this caveat the screw displacement trajectory is a useful concept when visualizing the rigid body displacement of a structure in a macromolecular viewer, because the magnitude of the displacements are small compared to the size of the rigid body.
</p>

<p>
The positional model used to refine crystallographic atomic coordinates is a probabilistic model.  The atomic coordinates are a atom's mean position as measured over the time of the experiment, and lattice positional differences of all crystallographically equivalent atoms.  Individual atomic ADPs give the mean square deviation(MSD) of the ensemble of crystallographically equivalent atoms from their mean position within the Gaussian model.  Gaussian MSD is also called variance, and is the square of root mean square deviation <var>sigma</var>.  The TLS rigid body model predicts the anisotropic ADPs for atoms based on their vector position relative the the TLS tensor origin.  The TLS model does this assuming the atoms are all points on a rigid body undergoing displacement.  This is not a Euclidean rigid body displacement, because ADPs are the MSD magnitudes of the atom's position.  The re-formulation of the Euclidean rigid body displacement to predict anisotropic ADPs results in a more complex description of rigid body motion requiring 20 unique parameters arranged into three 3x3 tensors: <var>T</var>, <var>L</var>, and <var>S</var>.  The <var>T</var> tensor, or translation tensor, is a symmetric 3x3 tensor(six unique parameters) with elements given in units of Angstroms<sup class=exponent>2</sup> just like the individual atomic anisotropic displacement tensor <var>U</var>.  The <var>T</var> tensor is the anisotropic translational displacement common to all atoms in the rigid body group.  The <var>L</var>, or libration(rotation) tensor, is also a symmetric 3x3 tensor with elements in units of <var>radians<sup class=exponent>2</sup></var>, but commonly converted to <var>degrees<sup class=exponent>2</sup></var> when reported.  The libration tensor describes rotational component of the rigid body displacement.  The TLS displacement parameters do not describe displacement directly, but rather give the probabilistic variance in terms of rotation and translation from the refined mean coordinates.   <var>T</var> and <var>L</var> tensors are Gaussian variance-covariance tensors, which makes intuitive sense since the anisotropic ADP tensors <var>U<sup>TLS</sup></var> the TLS model predicts are also Gaussian variance-covariance tensors.  The <var>S</var> tensor is not usually symmetric, and isn't as easy to interpret directly like the <var>L</var> and <var>T</var> tensors.  It exists in the TLS model to account for a rotation-translation correlation which occurs when a rigid body undergoes rotation about three orthogonal rotation axes which do not intersect at a common point.
</p>

<p>
Given the TLS tensors and their origin, a TLS predicted anisotropic ADP may be calculated for any atom using its position relative to the TLS origin by the set of linear equations given in <b>Table 1</b>.
</p>

<table width="100%" border=1>
 <caption>
  <b>Table 1</b>:
  Linear Equations Relating TLS Tensors to the Individual Anisotropic ADP tensor <var>U<sup>TLS</sup></var> for a Atom at position <var>x,y,z</var> With Respect to the TLS Origin of Calculations.  The rotational units of units of <var>L</var> and <var>S</var> must be given in radians.
 </caption>

 <tr>
  <th><var>U<sup>TLS</sup><sub>ij</sub></var></th>
  <th>Equation</th>
 </tr>

 <tr>
  <td><var>U<sup>TLS</sup><sub>11</sub></var></td>
  <td>
   <var>L<sub>22</sub></var><var>z<sup>2</sup></var>+
   <var>L<sub>33</sub></var><var>y<sup>2</sup></var>-
   2<var>L<sub>23</sub></var><var>yz</var>+
   2<var>S<sub>21</sub></var><var>z</var>-
   2<var>S<sub>31</sub></var><var>y</var>+
   <var>T<sub>11</sub></var>
  </td>
 </tr>

 <tr>
  <td><var>U<sup>TLS</sup><sub>22</sub></var></td>
  <td>
   <var>L<sub>11</sub></var><var>z<sup>2</sup></var>+
   <var>L<sub>33</sub></var><var>x<sup>2</sup></var>-
   2<var>L<sub>31</sub></var><var>xz</var>-
   2<var>S<sub>12</sub></var><var>z</var>+
   2<var>S<sub>32</sub></var><var>x</var>+
   <var>T<sub>22</sub></var>
  </td>
 </tr>

 <tr>
  <td><var>U<sup>TLS</sup><sub>33</sub></var></td>
  <td>
   <var>L<sub>11</sub></var><var>y<sup>2</sup></var>+
   <var>L<sub>22</sub></var><var>x<sup>2</sup></var>-
   2<var>L<sub>12</sub></var><var>xy</var>-
   2<var>S<sub>23</sub></var><var>x</var>+
   2<var>S<sub>13</sub></var><var>y</var>+
   <var>T<sub>33</sub></var>
  </td>
 </tr>

 <tr>
  <td><var>U<sup>TLS</sup><sub>12</sub></var></td>
  <td>
   -<var>L<sub>33</sub></var><var>xy</sup></var>+
   <var>L<sub>23</sub></var><var>xz</var>-
   <var>L<sub>13</sub></var><var>yz</var>-
   <var>L<sub>12</sub></var><var>z<sup>2</sup></var>-
 
   <var>S<sub>11</sub></var><var>z</var>+
   <var>S<sub>22</sub></var><var>z</var>+
   <var>S<sub>31</sub></var><var>x</var>-
   <var>S<sub>32</sub></var><var>y</var>+ 

  <var>T<sub>12</sub></var>
  </td>
 </tr>

 <tr>
  <td><var>U<sup>TLS</sup><sub>13</sub></var></td>
  <td>
   -<var>L<sub>22</sub></var><var>xz</sup></var>+
   <var>L<sub>23</sub></var><var>yx</var>-
   <var>L<sub>13</sub></var><var>y<sup>2</sup></var>+
   <var>L<sub>12</sub></var><var>yz</var>+
 
   <var>S<sub>11</sub></var><var>y</var>-
   <var>S<sub>33</sub></var><var>y</var>+
   <var>S<sub>23</sub></var><var>z</var>-
   <var>S<sub>21</sub></var><var>x</var>+

   <var>T<sub>13</sub></var>
  </td>
 </tr>

 <tr>
  <td><var>U<sup>TLS</sup><sub>23</sub></var></td>
  <td>
   -<var>L<sub>11</sub></var><var>yz</var>-
   <var>L<sub>23</sub></var><var>x<sup>2</sup></var>+
   <var>L<sub>13</sub></var><var>xy</var>+
   <var>L<sub>12</sub></var><var>xz</var>-
 
   <var>S<sub>22</sub></var><var>x</var>+
   <var>S<sub>33</sub></var><var>x</var>+
   <var>S<sub>12</sub></var><var>y</var>-
   <var>S<sub>13</sub></var><var>z</var>+

   <var>T<sub>23</sub></var>
  </td>
 </tr>
</table>

<p>
These equations can also be used to fit TLS tensors to the experimental individual ADPs of a group of atoms in a crystal structure.  This requires at least 6 atoms with anisotropic ADPs, or 20 atoms with isotropic ADPs.  Isotropic ADPs must be converted from their typical <var>B</var> values to equivalent <var>U<sup>ISO</sup></var> tensors.  Fitting a group of residues in a macro molecule often involves enough atoms so that the TLS parameters are overdetermined.  When this is the case, the TLS calculated <var>U<sup>TLS</sup></var> tensors can be compared with the experimental <var>U</var> tensors to quantify how well the model fit.  TLSView reports two ADP comparison functions: <b>R</b>, and <b>dP<sup>2</sup></b>.  
</p>

<p>
<var>U</var>, <var>T</var>, and <var>L</var> are all trivariate Gaussian variance-covariance tensors.  Since they are symmetric, each has six independent parameters.  Three parameters are the principal MSDs along orthogonal axes, and three are the rotational orientation of the principal axes with respect to the current coordinate system.  When a tensor is rotated to its principal axes, the off-diagonal terms become zero and the principal axis MSDs can be read from the diagonal elements.  The orientation of the principal axes can be found by calculating the tensor eigenvectors.  Most programming routines for calculating eigenvectors return the normalized eigenvalue-eigenvector pairs.  The eigenvalue is the independent MSD in the direction of the eigenvector.  <b>Table 2</b> gives a overview of some useful properties common to all trivariate Gaussian variance-covariance tensors.
</p>

<table width="100%" border=1>
 <caption>
  <b>Table 2</b>: Properties of Trivariate Gaussian Tensor(3x3 Matrix) <var>S</var>
 </caption>

 <tr>
  <th>Calculation</th>
  <th>Description</th>
 <tr>

 <tr>
  <td>
   <var>s<sub>11</sub></var>+<var>s<sub>22</sub></var>+<var>s<sub>33</sub></var>
  </td>
  <td>Trace of <var>S</var>.  The trace is always equal to the sum of three principal MSDs, and is invariant under rotation.</td>
 </tr>

 <tr>
  <td>
   1/3*(<var>s<sub>11</sub></var>+<var>s<sub>22</sub></var>+<var>s<sub>33</sub></var>)
  </td>
  <td>The isotropic approximation of <var>S</var>.</td>
 </tr>

 <tr>
  <td><b>eigenvalues(</b><var>S</var><b>)</b></td>
  <td>The MSD magnitudes of the principal axes of <var>S</var>.</td>
 </tr>

 <tr>
  <td><b>eigenvectors(</b><var>S</var><b>)</b></td>
  <td>The principal axes of <var>S</var>.</td>
 </tr>

 <tr>
  <td>
   <var>n<sup>t</sup>Sn</var><br>
   <b>sqrt(</b><var>n<sup>t</sup>Sn</var><b>)</b>
  </td>
  <td>The MSD/RMSD(root mean square deviation) magnitude in the direction of unit vector <var>n</var>.  The anisotropic ADP visualization often referred to as "peanuts" is generated by the RMSD surface of a atom's <var>U</var> tensor.</td>
 </tr>

 <tr>
  <td><var>C</var>*<b>sqrt(</b><var>n<sup>t</sup>S<sup>-1</sup>n</var><b>)</b></td>
  <td>The distance to the isoprobability ellipsoid surface of <var>S</var> in the direction of unit vector <var>n</var>. The critical value <var>C</var> determines the amount of probability enclosed by the ellipsoid.  The value of <var>C</var> is obtained by numerical integration of the trivariate Gaussian, but is constant for all trivariate Gaussian distributions, so the values of <var>C</var> are often just looked up in a table.
 </tr>
</table>

<center>
<table width="75%">
 <tr><th><img src="ROTATION2D.png"></th></tr>
 <tr><td>
   <b>Figure 2</b>: Two equivalent displacements of a rigid body.  (A) The rigid body is displaced by a translation followed by by a rotation about its centroid.  (B) The same displacement reduced to a single rotation about a unique axis.
 </td></tr>
</table>
</center>

<p>
The reduction of a given TLS model to three translational displacements and three screw displacements is accomplished by a series of tensor transformations.  The parameters from the <var>L</var> and <var>S</var> tensor are combined to calculate the screw displacements, and the <var>T</var> tensor is reduced to a new translation tensor <var>T<sup>r</sup></var> which is a absolute minimum translational component for the TLS displacement.  Put another way, this reduction maximizes the displacement contribution from the screw axes while minimizing the displacement contribution from pure translation.  <b>Figure 2</b> demonstrates this type of reduction in two dimensions, where it is possible to completely eliminate the translational displacement.  This is accomplished by shifting the object rotation origin to a unique point where the rotation alone will complete the displacement.  Attempting this reduction on a displaced object in three dimensions leads to the result of Chastles' thereom, because a rotation about a axis displaces a object in the plane perpendicular to the rotation axis, and the remaining displacement is a translation perpendicular to the plane(parallel to the rotation axis).  The translational contribution of a TLS displacement is also minimized by a origin shift.  There is a unique tensor origin which minimizes the trace of <var>T</var>, and makes the <var>S</var> tensor symmetric.  This origin is called the <b>center of reaction</b>(<var>cor</var>).  The center of reaction is independent of the original tensor origin of calculation which is usually arbitrary.  Once the TLS tensor origin is shifted to the <var>cor</var>, the <var>L<sup>cor</sup></var> and <var>S<sup>cor</sup></var> tensors can be used to calculate three perpendicular non-intersecting screw displacements which reduces the trace of <var>T<sup>cor</sup></var> further, resulting in a new  reduced translation tensor <var>T<sup>r</sup></var>.  <b>Table 3</b> gives a overview of all the the parameters involved in this reduction.

<table width="100%" border=1>
 <caption>
  <b>Table 3</b>: TLS Parameter Summary
 </caption> 

 <tr>
  <th>Symbol</th>
  <th>Parameter</th>
  <th>Type</th>
  <th>Units</td>
  <th>Description</th>
 </tr>

 <tr>
  <td><var>oc<sub>i</sub></var></td>
  <td>TLS Origin of Calculations</td>
  <td>3x1 vector/point</td>
  <td><acronym title="Angstroms">A</acronym></td>
  <td>
   The arbitrary origin of calculations, meaning the origin of the <var>T</var>, <var>L</var>, and <var>S</var> tensors.  The positions of the atoms of a TLS group are calculated relative to this origin.
  </td>
 </tr>

 <tr>
  <td><var>U<sub>ij</sub></var></td>
  <td>Anisotropic ADP Tensor</td>
  <td>3x3 symmetric tensor</td>
  <td><acronym title="Angstroms">A</acronym><sup class=exponent>2</sup></td>
  <td>
   The anisotropic form of a individual atomic displacement
   parameter(ADP).
  </td>
 </tr>

 <tr>
  <td><var>U<sup>TLS</sup><sub>ij</sub></var></td>
  <td>TLS Calculated Anisotropic ADP Tensor</td>
  <td>3x3 symmetric tensor</td>
  <td><acronym title="Angstroms">A</acronym><sup class=exponent>2</sup></td>
  <td>
   The anisotropic ADP calculated from a TLS model.
  </td>
 </tr>

 <tr>
  <td><var>T<sub>ij</sub></var></td>
  <td>Translation Tensor</td>
  <td>3x3 symmetric tensor</td>
  <td><acronym title="Angstroms">A</acronym><sup class=exponent>2</sup></td>
  <td>
   The translation tensor of the TLS model.  This tensor describes the anisotropic translational component of the rigid body displacement the same way the anisotropic atomic displacement parameters in <var>U</var> describes the translation displacement for a single atom.
  </td>
 </tr>

 <tr>
  <td><var>L<sub>ij</sub></var></td>
  <td>Libration (Rotation) Tensor</td>
  <td>3x3 symmetric tensor</td>
  <td>
   <acronym title="Radians">RAD</acronym><sup class=exponent>2</sup> or
   <acronym title="Degrees">DEG</acronym><sup class=exponent>2</sup>
  </td>
  <td>
   The libration tensor of the TLS model.  This describes the rotational component of the rigid body displacement.
  </td>
 </tr>

 <tr>
  <td><var>S<sub>ij</sub></var></td>
  <td>Skew/Screw Tensor</td>
  <td>3x3 non-symmetric tensor</td>
  <td>
   (<acronym title="Angstroms">A</acronym>*<acronym title="Radians">RAD</acronym>) or
   (<acronym title="Angstroms">A</acronym>*<acronym title="Degrees">DEG</acronym>)
  </td>
  <td>
   The skew tensor of the TLS model.  This describes
   rotation-translation correlation which happens when
   the rigid body is rotated about three orthogonal 
   rotation axes which do not intersect at a single point.
   The skew tensor is generally non-symmetric, but through
   a transformation of the TLS model origin a unique origin
   may be found where it becomes symmetric.  This origin is called
   the <b>center of reaction</b>.
  </td>
 </tr>

 <tr>
  <td><var>cor<sub>i</sub></var></td>
  <td>Center of Reaction</td>
  <td>3x1 vector/point</td>
  <td><acronym title="Angstroms">A</acronym></td>
  <td>
   The center of reaction is a special origin which can be calculated using the <var>T</var> <var>L</var>, <var>S</var>, and <var>oc</var> parameters of a existing TLS model.  The center of reaction is independent of the TLS model's origin of calculations, and once it has been calculated, the TLS tensors can be transformed to use the center of reaction as the origin of calculations for a new TLS model which predicts the same anisotropic ADPs as the TLS model it was derived from.
  </td>
 </tr>

 <tr>
  <td><var>T<sup>cor</sup><sub>ij</sub></var></td>
  <td>Translation Tensor at the Center of Reaction</td>
  <td>3x3 symmetric tensor</td>
  <td><acronym title="Angstroms">A</acronym><sup class=exponent>2</sup></td>
  <td>
   The translation tensor after the origin shift to the center of reaction.  The shift to the center of reaction minimizes the trace of the translation tensor.
  </td>
 </tr>

 <tr>
  <td><var>T<sup>r</sup><sub>ij</sub></var></td>
  <td>Reduced Translation Tensor</td>
  <td>3x3 symmetric tensor</td>
  <td><acronym title="Angstroms">A</acronym><sup class=exponent>2</sup></td>
  <td>
   This is what is left of the translation tensor after the displacements of the <var>L<sup>cor</sup></var> and <var>S<sup>cor</sup></var> have been reduced to three non-intersecting screw axes.
  </td>
 </tr>

 <tr>
  <td><var>L<sup>cor</sup><sub>ij</sub></var></td>
  <td>Libration (Rotation) Tensor at the Center of Reaction</td>
  <td>3x3 symmetric tensor</td>
  <td>
   <acronym title="Radians">RAD</acronym><sup class=exponent>2</sup> or
   <acronym title="Degrees">DEG</acronym><sup class=exponent>2</sup>
  </td>
  <td>
   The libration tensor after the shift to the center of reaction.  Shifting to a new origin has no effect on the components of the libration tensor.
  </td>
 </tr>

 <tr>
  <td><var>S<sup>cor</sup><sub>ij</sub></var></td>
  <td>Skew/Screw Tensor</td>
  <td>3x3 symmetric tensor</td>
  <td>
   (<acronym title="Angstroms">A</acronym>*<acronym title="Radians">RAD</acronym>) or
   (<acronym title="Angstroms">A</acronym>*<acronym title="Degrees">DEG</acronym>)
  </td>
  <td>
   The skew tensor after the shift to the center of reaction.  The center of reaction is the only possible origin which can make the skew tensor symmetric, and is therefore a unique origin for a given TLS model.
  </td>
 </tr>

 <tr>
  <td><var>rho<sup>l</sup><sub>i</sub></var></td>
  <td>Position of Screw Axis <var>l</var> With Respect to <var>cor</var></td>
  <td>3x1 vector</td>
  <td><acronym title="Angstroms">A</acronym></td>
  <td>
   Three vectors <var>l={1,2,3}</var> corresponding to the three eigenvectors of <var>L<sup>cor</sup></var>.  The eigenvectors displaced from the <var>cor</var> by <var>rho</var> are the position and orientation of the TLS canonical screw axes.
  </td>
 </tr>

 <tr>
  <td><var>pitch<sup>l</sup></var></td>
  <td>Pitch of Screw Axis <var>l</var></td>
  <td>Real Number</td>
  <td>
   (<acronym title="Angstroms">A</acronym>/<acronym title="Radians">RAD</acronym>) or
   (<acronym title="Angstroms">A</acronym>/<acronym title="Degrees">DEG</acronym>)
  </td>
  <td>
   Three screw pitches <var>l={1,2,3}</var> corresponding to the screw axes parallel to the three eigenvectors of <var>L<sup>cor</sup></var>.
  </td>
 </tr>
</table>


<!---------------------------------------------------------->
<!---------------------------------------------------------->
<hr>
<h3>TLS Visualizations</h3>

<center>
<table width="75%">
 <tr><td><b>(A)</b></td><td><b>(B)</b></td></tr>
 <tr>
  <th>
   <a href="1VJU_ELLIPSE.png">
    <img src="1VJU_ELLIPSE_50.png" alt="Figure 1">
   </a>
  </th>
  <th>
   <a href="1VJU_BALL_STICK.png">
    <img src="1VJU_BALL_STICK_50.png" alt="Figure 1">
   </a>
  </th>
 </tr>

 <tr><td><b>(C)</b></td><td><b>(D)</b></td></tr>
 <tr>
  <th>
   <a href="1VJU_SURF.png">
    <img src="1VJU_SURF_50.png" alt="Figure 1">
   </a>
  </th>
  <th>
   <a href="1VJU_SURF_BALL_STICK.png">
    <img src="1VJU_SURF_BALL_STICK_50.png" alt="Figure 1">
   </a> 
  </th>
 </tr>

 <tr><td colspan=2>
   <b>Figure 3</b>: Four visualizations of the same TLS group along a alpha helix segment.  One copy of the structure is shown at the refined coordinates and colored by refined temperature factor.  The carbonyl atoms have been omitted for clarity.  The visualizations of TLS screw axes and <var>T<sup>r</sup></var> thermal ellipse are colored green.  Visualizations of TLS displaced atoms are also colored green.  (A) TLS calculated thermal ellipsoids of TLS group atoms with a isoprobability magnitude of 85%.  (B) Three green copies of the TLS group atoms as displaced by each screw axes to a magnitude of 85% isoprobability.  (C) The trajectory surfaces caused by the TLS screw displacements.  This surface is drawn along the atom bond vectors and shows the route the structure takes as it is incrementally displaced to a isoprobability magnitude of 85%.  Each screw displacement surface passes through the mean atomic coordinates(the crysallographically refined coordinates) and is symmetric with respect to them. (D) The screw displacement surface from figure C combined with the three rod visualizations from figure B.  This figure captures the rod visualizations at one end of their maximum screw displacement during animation in TLSView.  If this were a actual animation, the each rod model would travel from one end of its screw trajectory surface to the other.  The animation uses a <var>sin</var> function for convenience(what else would you use?), but this is not meant to imply classical harmonic motion.
 </td></tr>
</table>
</center>

<p>
The default TLS visualization used by TLSView assigns each TLS group a unique color and draws a <var>T<sup>r</sup></var> Gaussian isoprobability thermal ellipsoid at the TLS center of reaction, and draws the three screw axes as rods. A backbone trace is drawn over the residues spanned by the TLS group using the TLS group color.  The screw axis length is proportional to its MSD rotational magnitude and scaled by the user specified Gaussian isoprobability magnitude for the TLS group.  The translational displacement of each screw axis is visualized at the axis center where a the rod is drawn with a larger radius for a length equal to the translational displacement along the axis for the selected Gaussian isoprobability magnitude.  This feature of the screw axes may be obscured if they intersects the <var>T<sup>r</sup></var> ellipsoid, or if a axis screw pitch is so small it only shows up as a thin ring.  The user interface provides controls for shutting off individual visualizations if necessary.
</p>

<center>
<table width="75%">
 <tr>
  <th>
    <img src="ELLIPSE_AXES.png" alt="Figure 4">
  </th>
 </tr>
 <tr><td>
   <b>Figure 4</b>: Thermal ellipsoid and thermal axes visualization of a individual anisotropic ADP.  The thermal axes are the primary axes of the ellipse.  The ADP tensor used in this visualization has one axis twice as large as the other two.
 </td></tr>
</table>
</center>

<p>
One option for visualizing a TLS model is to use the TLS calculated individual anisotropic ADPs to draw thermal ellipsoids or thermal axes at every atom position(<b>Figure 3A</b>).  Atomic coordinates from a crystal structure are the mean position of all crystallographically equivalent atoms as measured over time and lattice position, and a thermal ellipsoid's surface encloses a volume containing the positions of a percentage of all equivalent atoms measured(within the Gaussian model).  Drawing thermal axes is a simplified visualization of the thermal ellipsoids where only the three primary axes of the ellipsoid are drawn(<b>Figure 4</b>).  Thermal axis length and the distance of the ellipsoid surface from the ellipsoid center both depend upon the user selected percentage of the Gaussian distribution to enclose, referred to here as isoprobability magnitude.  The TLSView default is 50%.  The thermal ellipsoid/axes visualization can be used for the TLS translation tensor too, but not the screw displacements.  TLSView introduces two new visualizations for the screw displacements: a surface tracing the screw trajectory of the TLS group atoms along bond lines(<b>Figure 3C</b>), and oscillating computer animation of any of the supported visualizations(<b>Figure 3B</b>) along the screw displacement paths.  The screw displacements are symmetric about the structure's mean position.  The screw animations use a harmonic animation function for illustration only, and in no way is meant to imply the group is acting as a harmonic oscillator.  The magnitude of the rotation about each axis depends on the MSD rotational magnitude for the axis and the Gaussian isoprobability magnitude set by the user.  The maximum rotational displacement for the surface or animation will partition the user-selected percentage of the total rotational displacement population.  The default is 50%.  This visualization is conceptually similar to the thermal axes visualization since the displacement surfaces are drawn from the three primary screw displacement axes and no covariance is shown.  TLSView has one control per TLS group for selecting the Gaussian isoprobability magnitude so that all ellipsoids, surfaces, and animations will be drawn in proper relative proportions.
</p>

<center>
<table width="75%">
 <tr>
  <th>
    <a href="UTLS_VS_UISO.png">
     <img src="UTLS_VS_UISO_50.png" alt="Figure 5">
    </a>
  </th>
 </tr>
 <tr><td>
   <b>Figure 5</b>: Thermal ellipsoid visualization comparing a least squares fit TLS model to the the crystallographically refined ADPs of 1R75 chain A's the backbone atoms.  A single TLS group was fit to all atoms in the chain and the screw axes and predicted ellipsoids drawn in green.  The experimental ADP ellipsoids(spheres in this case because the refined ADPs were isotropic) are colored by ADP(temperature factor) magnitude from blue(lowest) to red(highest).  The TLS predicted ellipsoids are larger than the refined ellipsoids near the interior of the protein, and smaller at the protein surface.  No sigma based weighting scheme was used for the least squares fit.
 </td></tr>
</table>
</center>

<p>
The thermal ellipsoid visualization in TLSView can be used to visually compare the displacement contributions of translational and screw TLS displacement in a TLS calculated ellipsoid.  The TLS calculated ellipsoid is rendered transparent, and a smaller ellipsoid calculated from the reduced translation tensor or the screw displacement is rendered opaque.  And example of this is shown in <b>Figure 1</b>.  TLSView uses the reduced translation ellipsoid for the opaque ellipsoid.
</p>

<p>When TLS parameters are fit to the refined isotropic or anisotropic ADPs, the thermal ellipsoids from the refined model and TLS model may be compared by drawing both ellipsoids.  <b>Figure 5</b> shows both experimental and TLS predicted ellipsoids for the backbone atoms of 1R75 chain A.  The refined isotropic ellipsoids are colored on a red to blue gradient by magnitude and the TLS predicted anisotropic ellipsoids are colored green, but rendered transparently.  The TLSView GUI supports transparency settings for most solid objects, and this is especially useful for an ellipsoid when a larger ellipsoid obscures a smaller one.  The isotropic ADPs from chain A ellipsoids are necessarily rendered as spheres, but a TLS model fit to them can predict anisotropic ellipsoids which show group displacement in a preferred direction.  
</p>

<!---------------------------------------------------------->
<!---------------------------------------------------------->
<hr>
<h3>User Interface: Main Window</h3>

<center>
<table width="75%">
 <tr>
  <th>
   <a href="1VJU_AB_12.png" alt="Figure 6">
    <img src="1VJU_AB_12_50.png" alt="Figure 6">
   </a>
  </th>
 </tr>
 
 <tr><td>
   <b>Figure 6</b>: TLSView main window with displaying chains A and B of structure 1VJU.  Each chain has been split into 12 TLS groups.  The unique color assignment occurs on a per-chain basis, so groups in chains A and B which share the same color are independent groups.  This color assignment scheme aids in comparing the TLS groups of homo-dimers.
 </td></tr>
</table>
</center>

<p>
The user interface of TLSView is programed using the GTK+ user interface toolkit, embedding a OpenGL rendering window using GtkGLExt widget.  It supports tabbed viewing, multiple windows, and loading multiple structures.  Commands are available through the menu bar as follows:
</p>

<table width="100%" border=1 align=left>
 <caption>
  <b>Table 4</b>: TLSView Main Window Menubar
 </caption>

 <tr>
  <th>Menu/Submenu</th>
  <th>Command Description</th>
 </tr>
 
 <tr>
  <td>File/*</td>
  <td> 
   Commands to open/close new windows, tables, and open structures files in PDB or mmCIF format.
  </td>
 </tr>

 <tr>
  <td>Visualization/Properties Browser...</td>
  <td>
   Opens the visualization properties browser dialog for the 
   visualization <b>Tab</b> currently in view.
  </td>
 </tr>

 <tr>
  <td>TLS/TLS Analysis</td>
  <td>
   Opens the TLS Analysis dialog for the macromolecular structure selected in the <b>Current Selection</b> bar.
  </td>
 </tr>
 
 <tr>
  <td>Structures/*</td>
  <td>
    Select the current structure.
  </td>
 </tr>
  
 <tr>
  <td>Help/About...</td>
  <td>
   Opens one mostly unhelpful dialog.
  </td>
 </tr>
</table>

<p>
The controls for structure navigation mimic <a href="http://pymol.sourceforge.net/">PyMOL(http://pymol.sourceforge.net)</a> implementing a virtual trackball and clipping plane adjustment.  All three mouse buttons and the <b>SHIFT</b> key are used:
</p>

<table border=1 width="100%">
 <caption>
  <b>Table 4</b>: Mouse Navigation Controls for Virtual Trackball and Clipping Plane Adjustment
 </caption>

 <tr>
  <th>Mouse Button</th>
  <th>No Key</th>
  <th>Depressing SHIFT</th>
 </tr>

 <tr>
  <td>Left</td>
  <td>XY Rotation</td>
  <td>No Change</td>
 </tr>

 <tr>
  <td>Middle</td>
  <td>XY Translation</td>
  <td>No Change</td>
 </tr>

 <tr>
  <td>Right</td>
  <td>Zoom In and Out</td>
  <td>Move Near and Far Clipping Plane</td>
 </tr>
</table>

<h3>User Interface: Visualization Properties Dialog</h3>

<center>
<table width="75%">
 <tr>
  <th><img src="VIS_PROP_DIALOG.png" alt="Figure 7"></th>
 </tr>
 
 <tr>
  <td>
   <b>Figure 7</b>: Visualization properties dialog for TLSView Tab 1.  The visualization properties of 1VJU chain B are selected.
  </td>
 </tr>
</table>
</center>

<p>
The Visualization Properties Dialog is used to modify the default visualization settings in TLSView.  Each tab window has its own Visualization Properties Dialog, and all the structures loaded in the tab window are arranged hierarchically by structure and chain in the left hand pane of the dialog.  The right hand pane displays panels containing settings for the currently selected visualization object, and any changes made to the visualization settings to not take effect until the <b>Apply</b> button has been depressed.  Most users familiar with molecular viewers will recognize the various options for visualizing structures, and most of the options work as expected.  Colors are selected through drop-down boxes which provide a menu of solid colors or color functions.  Depending on the object, the list of colors might be quite small, but the user can always enter a custom color using a floating point RGB triplet, separated by commas.  The range for each RGB value is between <b>0.0-1.0</b>.  When the selection <b>Random</b> is available in the menu, selecting it generates a single random RGB triplet which is displayed in the color selection entry box once applied.
</p>

<p>
The hierarchical arrangement of graphics objects allows parent objects to control the settings in their child objects.  This is the case for the <b>TLS Chain</b> object, which collects together the individual TLS groups defined in the chain.  Most options selected in the <b>TLS Chain</b> property panels are propagated to the <b>TLS Group</b> objects they contain, but properties of <b>TLS Group</b> objects can also be set individually.
</p>

<h3>User Interface: TLS Analysis Dialog</h3>
<center>
<table width="75%">
 <tr>
  <th><img src="TLS_ANALYSIS_DIALOG.png" alt="Figure 8"></th>
 </tr>
 
 <tr>
  <td>
   <b>Figure 8</b>: The TLS Analysis Dialog listing the TLS groups of structure 4HVP.
  </td>
 </tr>
</table>
</center>

<p>
The TLS Analysis dialog provides a interface for loading TLS group definitions for a macromolecular structure.  Active TLS groups are listed along with  useful information and  controls over the TLS visualization, although most of the TLS visualization options are manipulated through the <b>Visualization Properties</b> dialog which can be opened automatically by double-clicking on a TLS row.  The <b>Show</b> button will show/hide the entire visualization for the TLS group, and the <b>Animate</b> button turns on/off screw displacement animations.  The <b>TLS Group</b> column describes the TLS group, usually by showing the residue range of the TLS group, but this can also be a text name if the TLS group definition was loaded from a REFMAC5 TLSIN/TLSOUT file.  The trace of the <var>T<sup>cor</sup></var> and <var>L<sup>cor</sup></var> tensors are given, the <b>Source</b> column describes the source of the TLS group.
</p>

<p>
TLS groups can be loaded from the output files of a TLS crystallographic refinement, or fit by the method of least squares to the refined structure's isotropic or anisotropic ADPs.  TLSView supports the REFMAC5 TLSIN/TLSOUT file format.  The TLSIN file contains a listing of all TLS groups as defined by chain and residue segment.  The TLSOUT file uses the same format, but includes extra lines for each TLS group giving the origin of calculation, <var>T</var>, <var>L</var>, and <var>S</var> tensor values.  When a TLSIN file is loaded, TLSView attempts to automatically fit TLS parameters to the structure's refined ADPs for the residue ranges given.  When this fit is successful, the Source column indicates the group was "LSQ Fit".  The LSQ fit TLS parameters may be saved to a TLSOUT file by clicking the <b>Save TLSOUT</b> button.
</p>

<center>
<table width="75%">
 <tr>
  <th><img src="TLS_FIT.png" alt="Figure 9"></th>
 </tr>
 
 <tr>
  <td>
   <b>Figure 9</b>: Illustration of how the TLSView <b>Fit TLS Groups</b> algorithm selects protein segments for testing against the TLS model.  Each segment is fit to the TLS model by least squares using its refined atomic ADPs.  A segment width of four residues is shown in this figure, but the TLSView default is six and can be set through the user interface.
  </td>
 </tr>
</table>
</center>

<p>
Fitting TLS parameters to refined ADPs with groups defined in a TLSIN file requires the user to manually select the residues for each TLS group.  This may be useful for proteins which have well defined domains, but does not help search for such regions in a protein.  TLSView implements a simple rigid body search algorithm we call a TLS Running Segment Fit(TLS-RSF) which helps identify rigid regions of a structure.  The dialog for this running this algorithm is available through the <b>Fit TLS Groups</b> button.  It works by performing a least squares fit of TLS parameters to the first <var>w</var> continuous residues of a protein or biopolymer, moving the starting residue for the segment selection up the chain by one, and repeating the TLS fit until the segment reaches the end of the polymer(<b>Figure 9</b>).  The TLS predicted atomic ADPs are then compared with the refined ADPs by a goodness of fit metric function called <b>dP<sup>2</sup></b>.  Some of the TLS parameters fit this way result in <var>T</var> and <var>L</var> tensors with negative eigenvalues in violation of intrinsic TLS model assumptions.  These groups are automatically thrown out, and the valid groups are visualized and colored by their goodness of fit.  The color gradient used ranges from yellow for the best fit group, to black for the poorest fit.  The search dialog is shown in <b>Figure 10</b> and contains options for selecting specific chains, and options to filter out side chain atoms and atoms with partial occupancy.  <b>Figure 11A</b> shows the initial visualization of the TLS groups fit by the TLS-RSF algorithm for a structure of HIV protease(4HVP).  The visualization is cluttered with screw axes from all the overlapping TLS groups.  Once the screw axes are hidden(<b>Figure 11B</b>), the backbone trace is revealed.  It is colored by TLS goodness of fit and shows similar trends in the A and B chains of the 4HVP homo dimer.  Regions where the backbone trace is white could not be fit with a valid TLS model.  These regions could be heavily disordered, or have significant internal motion.
</p>

<center>
<table width="75%">
 <tr>
  <th><img src="TLS_FIT_DIALOG.png" alt="Figure 10"></th>
 </tr>
 
 <tr>
  <td>
   <b>Figure 10</b>: Option dialog for the TLS-RSF algorithm in TLSView.  This dialog shows chains A and B selected for TLS searching.  The residue segment length of each TLS group is set to six residues.  Side chain atoms and atoms with one bond are included in the TLS parameter least squares fit, but atoms with partial occupancy are omitted.
  </td>
 </tr>
</table>
</center>

<center>
<table width="75%">
 <tr><td><b>(A)</b></td></tr>
 <tr>
  <th><img src="4HVP_TLS_FIT_AXES.png" alt="Figure 11A"></th>
 </tr>
 <tr><td><b>(B)</b></td></tr>
 <tr>
  <th><img src="4HVP_TLS_FIT.png" alt="Figure 11B"></th>
 </tr>
 <tr><td><b>(C)</b></td></tr>
 <tr>
  <th><img src="4HVP_TLS_FIT_FANS.png" alt="Figure 11C"></th>
 </tr>

 <tr>
  <td>
   <b>Figure 11</b>: Three visualizations of TLS-RSF generated TLS groups fit to the isotropic ADPs of HIV protease(4HVP) using a segment width of eight residues.  Many overlapping TLS groups are shown with this visualization.  Each TLS visualization is colored by its goodness of fit to the TLS model from yellow(best fit) to blue then black(poorest fit).  (A) Shows the default visualization cluttered by a overwhelming number of screw axes.  (B) Shows the same visualization with the TLS screw axes hidden.  Each residue of the backbone trace is colored using fit gradient color of TLS group which fits it best, so continuous regions of good TLS fit may span multiple TLS groups with very different displacements. (C) Drawing a series of connected triangles using the TLS group center of reaction for one triangle vertex, and successive backbone atoms of the TLS segment for the other two triangle vertexes yields a visualization which looks like a paper/bamboo fan.  The fans help identify TLS groups with similar centers of reaction, and therefore are likely to have similar displacements.
  </td>
 </tr>
</table>
</center>

<h3>User Interface: Visualization Properties For TLS Groups</h3>

<center>
<table width="75%">
 <tr>
  <th><img src="VIS_PROP_TLS_DIALOG.png" alt="Figure 12"></th>
 </tr>
 
 <tr>
  <td>
   <b>Figure 12</b>: Visualization properties of a TLS Chain visualization object.  TLS Chain visualization objects contain all TLS Group visualization objects on a chain.  Setting changed in TLS Chain objects are propagated to all the TLS Group visualization objects.
  </td>
 </tr>
</table>
</center>

<p>
</p>


<table width="100%" border=1>
 <caption>
  <b>Table 5</b>: TLS Visualization Properties
 </caption>

 <tr>
  <th>Option</th><th>Description</th>
 </tr>

 <tr>
  <td><small>Show COR-Backbone Fan<</small>/td>
  <td>Draws a series of connected triangles using the TLS group center of reaction as one triangle vertex, and successive backbone atoms of the TLS group residues for the other two triangle vertexes.</td>
 </tr>

 <tr>
  <td><small>Show TLS <var>T<sup>r</sup></var>/Screw Axes</small></td>
  <td>Draws a static visualization of the three translational and three screw displacements of the TLS group.  The thermal ellipsoid of the <var>T<sup>r</sup></var> tensor is drawn at the center of reaction, and the three screw axes drawn with a length proportional to their RMSD rotational magnitude.</td>
 </tr>

 <tr>
  <td><small>Show <var>U<sup>TLS</sup></var> Thermal Axes</small></td>
  <td>Draws <var>U<sup>TLS</sup></var> thermal axes for selected TLS group atoms.</td>
 <tr>

 <tr>
  <td><small>Show <var>U<sup>TLS</sup></var> Thermal Ellipsoids</small></td>
  <td>Draws <var>U<sup>TLS</sup></var> thermal ellipsoids for selected TLS group atoms.</td>
 <tr>

 <tr>
  <td><small>Show <var>U<sup>TLS</sup></var> Thermal Peanuts</small></td>
  <td>Draws <var>U<sup>TLS</sup></var> thermal peanuts for selected TLS group atoms.</td>
 <tr>

 <tr>
  <td><small>Show <var>T<sup>r</sup></var> Thermal Axes</small></td>
  <td>Draws <var>T<sup>r</sup></var> thermal axes for selected TLS group atoms.</td>
 <tr>

 <tr>
  <td><small>Show <var>T<sup>r</sup></var> Thermal Ellipsoids</small></td>
  <td>Draws <var>T<sup>r</sup></var> thermal ellipsoids for selected TLS group atoms.</td>
 <tr>

 <tr>
  <td><small>Show <var>T<sup>r</sup></var> Thermal Peanuts</small></td>
  <td>Draws <var>T<sup>r</sup></var> thermal peanuts for selected TLS group atoms.</td>
 <tr>

 <tr>
  <td><small>Show L1,L2,L3 Screw Displacement Surface</small></td>
  <td>Draws the screw displacement trajectory surface for the screw axes derived from the first, second, and third eigenvector of the <var>L<sup>cor</sup></var> tensor.</td>
 <tr>

 <tr>
  <td><small>Add Atom <var>B<sup>ISO</sup></var> to <var>U<sup>TLS</sup></var></small></td>
  <td>When viewing TLS groups refined by REFMAC5, it is necessary to add the residual isotropic temperature factor to the TLS calculated anisotropic ADP tensor.  TLS parameters refined using REFMAC often predict non-positive definite <var>U<sup>TLS</sup></var> atomic ADPs which cannot be visualized as a Gaussian probability distributions.  Adding the residual refined <var>B<sup>ISO</sup></var> to the TLS calculated tensor for each atom usually makes the tensor positive definite and accurately represents the refined ADP.</td>
 <tr>

 <tr>
  <td><small>TLS Group Visualization Color</small></td>
  <td>Sets the color used by all of this group's TLS visualizations. </td>
 <tr>

 <tr>
  <td><small>Isoprobability Magnitude</small></td>
  <td>The Gaussian isoprobability magnitude for used by thermal axes, thermal ellipsoid, and screw displacement surface visualizations for the TLS group.</td>
 <tr>

 <tr>
  <td><small>Scale Screw Axes Length</small></td>
  <td>Scale the length of the screw axes by the given real number.</td>
 <tr>

 <tr>
  <td><small>Screw Axes Radius</small></td>
  <td>The radius of the screw axes in Angstroms.</td>
 <tr>

 <tr>
  <td><small><var>U<sup>TLS</sup></var> Thermal Ellipsoid Opacity</small></td>
  <td>Opacity setting for thermal ellipsoids.</td>
 <tr>

 <tr>
  <td><small><var>U<sup>TLS</sup></var> Thermal Peanut Opacity</small></td>
  <td>Opacity setting for thermal peanuts.</td>
 <tr>

 <tr>
  <td><small><var>U<sup>TLS</sup></var> Thermal Peanut Opacity</small></td>
  <td>Opacity setting for thermal peanuts.</td>
 <tr>

 <tr>
  <td><small>Screw Displacement Surface Opacity</small></td>
  <td>Opacity setting for the screw displacement surfaces.</td>
 <tr>

 <tr>
  <td><small>COR-Backbone Fan Opacity</small></td>
  <td>Opacity setting for the COR-Backbone Fan.</td>
 <tr>

 <tr>
  <td><small>Simulation Time</small></td>
  <td>Simulation time setting for the harmonic animation of atom visualization about the three TLS screw axes.  The time range is from 0.0-1.0, and fed as <var>x</var> to the function <var>sin(2*pi*x)</var> to calculate the screw displacement magnitude rendered in the visualization.</td>
 <tr>

 <tr>
  <td><small><var>L<sub>1,2,3</sub></var> Simulation Rotation</small></td>
  <td>The rotation currently used for the three screw displaced visualizations.</td>
 <tr>
</table>


<hr>
<p>
Last modified by <i>Jay Painter</i>
</p>

</body>
</html>
